{% extends "clientmanager/base.html" %}

{% load static %}


{% block title %}Home Page{% endblock %}
{% block extra_head %}
{# <!-- <style>body{background-color:white;}</style> --> #}
{# <!--<link href="{% static 'client_engagement_dashboard_files/htmltools-fill-0.5.8.1/fill.css' %}" rel="stylesheet" /> --> #}
<script src="{% static 'client_engagement_dashboard_files/htmlwidgets-1.6.4/htmlwidgets.js' %}"></script>
<script src="{% static 'client_engagement_dashboard_files/jquery-1.11.1/jquery.min.js' %}"></script>
{# <!-- <link href="{% static 'client_engagement_dashboard_files/dygraphs-1.1.1/dygraph.css' %}" rel="stylesheet" /> -->#}
<script src="{% static 'client_engagement_dashboard_files/dygraphs-1.1.1/dygraph-combined.js' %}"></script>
<script src="{% static 'client_engagement_dashboard_files/dygraphs-1.1.1/shapes.js' %}"></script>
<script src="{% static 'client_engagement_dashboard_files/moment-2.8.4/moment.js' %}"></script>
<script src="{% static 'client_engagement_dashboard_files/moment-timezone-0.2.5/moment-timezone-with-data.js' %}"></script>
<script src="{% static 'client_engagement_dashboard_files/moment-fquarter-1.0.0/moment-fquarter.min.js' %}"></script>
<script src="{% static 'client_engagement_dashboard_files/dygraphs-binding-1.1.1.6/dygraphs.js' %}"></script>
<style>
/* Modal shell */
.pid-modal { display: none; position: fixed; inset: 0; z-index: 1000; }
.pid-modal.is-open { display: block; }
/* Backdrop */
.pid-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.5); }
/* Dialog */
.pid-dialog {
  position: relative; margin: 10vh auto 0; max-width: 420px;
  background: #fff; border-radius: 12px; padding: 24px 20px; box-shadow: 0 10px 40px rgba(0,0,0,.25);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}
.pid-close {
  position: absolute; top: 8px; right: 10px; border: none; background: transparent; font-size: 22px; cursor: pointer;
}
.pid-label { display:block; margin: 8px 0 6px; font-weight:600; }
.pid-input {
  width: 100%; padding: 10px 12px; border: 1px solid #cfd4d9; border-radius: 8px; outline: none;
}
.pid-input:focus { border-color: #5b9cff; box-shadow: 0 0 0 3px rgba(91,156,255,.2); }
.pid-submit {
  width: 100%; margin-top: 14px; padding: 10px 12px; border: 0; border-radius: 8px; cursor: pointer;
  background: #0d6efd; color: #fff; font-weight: 600;
}
.pid-submit:hover { filter: brightness(0.95); }
.pid-note { margin-top: 8px; font-size: 12px; color: #6b7280; text-align:center; }
</style>

{% endblock %}
{% block content %}
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-expand bg-white shadow mb-4 topbar">
                    <div class="container-fluid"><button class="btn btn-link d-md-none me-3 rounded-circle" id="sidebarToggleTop" type="button"><i class="fas fa-bars"></i></button>
                        <form class="d-none d-sm-inline-block mw-100 ms-md-3 me-auto my-2 my-md-0 navbar-search">
                            <div class="input-group"><input class="bg-light form-control border-0 small" type="text" placeholder="Search for ..."><button class="btn btn-primary py-0" type="button"><i class="fas fa-search"></i></button></div>
                        </form>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown d-sm-none no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><i class="fas fa-search"></i></a>
                                <div class="dropdown-menu p-3 dropdown-menu-end animated--grow-in" aria-labelledby="searchDropdown">
                                    <form class="w-100 me-auto navbar-search">
                                        <div class="input-group"><input class="bg-light border-0 form-control small" type="text" placeholder="Search for ..."><button class="btn btn-primary" type="button"><i class="fas fa-search"></i></button></div>
                                    </form>
                                </div>							
                            </li>         

							<li class="nav-item mx-1 dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span class="badge bg-danger badge-counter">3+</span><i class="fas fa-bell fa-fw"></i></a>
                                    <div class="dropdown-menu dropdown-menu-end dropdown-list animated--grow-in">
                                        <h6 class="dropdown-header">alerts center</h6><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3">
                                                <div class="bg-primary icon-circle"><i class="fas fa-file-alt text-white"></i></div>
                                            </div>
                                            <div><span class="small text-gray-500">December 12, 2019</span>
                                                <p>A new monthly report is ready to download!</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3">
                                                <div class="bg-success icon-circle"><i class="fas fa-donate text-white"></i></div>
                                            </div>
                                            <div><span class="small text-gray-500">December 7, 2019</span>
                                                <p>$290.29 has been deposited into your account!</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3">
                                                <div class="bg-warning icon-circle"><i class="fas fa-exclamation-triangle text-white"></i></div>
                                            </div>
                                            <div><span class="small text-gray-500">December 2, 2019</span>
                                                <p>Spending Alert: We've noticed unusually high spending for your account.</p>
                                            </div>
                                        </a><a class="dropdown-item text-center small text-gray-500" href="#">Show All Alerts</a>
                                    </div>
                                </div>
                            </li>
                            <li class="nav-item mx-1 dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span class="badge bg-danger badge-counter">7</span><i class="fas fa-envelope fa-fw"></i></a>
                                    <div class="dropdown-menu dropdown-menu-end dropdown-list animated--grow-in">
                                        <h6 class="dropdown-header">alerts center</h6><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3 dropdown-list-image"><img class="rounded-circle" src="{% static 'clientmanager/assets/img/avatars/avatar4.jpeg' %}">
                                                <div class="bg-success status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>Hi there! I am wondering if you can help me with a problem I've been having.</span></div>
                                                <p class="mb-0 small text-gray-500">Emily Fowler - 58m</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3 dropdown-list-image"><img class="rounded-circle" src="{% static 'clientmanager/assets/img/avatars/avatar2.jpeg' %}">
                                                <div class="status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>I have the photos that you ordered last month!</span></div>
                                                <p class="mb-0 small text-gray-500">Jae Chun - 1d</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3 dropdown-list-image"><img class="rounded-circle" src="{% static 'clientmanager/assets/img/avatars/avatar3.jpeg' %}">
                                                <div class="bg-warning status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>Last month's report looks great, I am very happy with the progress so far, keep up the good work!</span></div>
                                                <p class="mb-0 small text-gray-500">Morgan Alvarez - 2d</p>
                                            </div>
                                        </a><a class="dropdown-item d-flex align-items-center" href="#">
                                            <div class="me-3 dropdown-list-image"><img class="rounded-circle" src="{% static 'clientmanager/assets/img/avatars/avatar5.jpeg' %}">
                                                <div class="bg-success status-indicator"></div>
                                            </div>
                                            <div class="fw-bold">
                                                <div class="text-truncate"><span>Am I a good boy? The reason I ask is because someone told me that people say this to all dogs, even if they aren't good...</span></div>
                                                <p class="mb-0 small text-gray-500">Chicken the Dog · 2w</p>
                                            </div>
                                        </a><a class="dropdown-item text-center small text-gray-500" href="#">Show All Alerts</a>
                                    </div>
                                </div>
                                <div class="shadow dropdown-list dropdown-menu dropdown-menu-end" aria-labelledby="alertsDropdown"></div>
                            </li>
                            <div class="d-none d-sm-block topbar-divider"></div>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#"><span class="d-none d-lg-inline me-2 text-gray-600 small">{{ request.COOKIES.username|default:"(none)" }}</span><img class="border rounded-circle img-profile" src="{% static 'clientmanager/assets/img/avatars/avatar1.jpeg' %}"></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"><a class="dropdown-item" href="#"><i class="fas fa-user me-2 fa-sm fa-fw text-gray-400"></i>&nbsp;Profile</a><a class="dropdown-item" href="#"><i class="fas fa-cogs me-2 fa-sm fa-fw text-gray-400"></i>&nbsp;Settings</a><a class="dropdown-item" href="#"><i class="fas fa-list me-2 fa-sm fa-fw text-gray-400"></i>&nbsp;Activity log</a>
                                        <div class="dropdown-divider"></div><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2 fa-sm fa-fw text-gray-400"></i>&nbsp;Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="container-fluid">
                    <div class="d-sm-flex justify-content-between align-items-center mb-4">
                        <h3 class="text-dark mb-0">Dashboard</h3><a class="btn btn-primary btn-sm d-none d-sm-inline-block" role="button" href="#"><i class="fas fa-download fa-sm text-white-50"></i>&nbsp;Generate Report</a>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow py-2 border-left-primary">
                                <div class="card-body">
                                    <div class="row g-0 align-items-center">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-primary mb-1 fw-bold text-xs"><span>Earnings (monthly)</span></div>
                                            <div class="text-dark mb-0 fw-bold h5"><span>$40,000</span></div>
											<p class="text-muted small">
											</p>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-calendar fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
						</div>
						<div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow py-2 border-left-success">
                                <div class="card-body">
                                    <div class="row g-0 align-items-center">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-success mb-1 fw-bold text-xs"><span>Earnings (annual)</span></div>
                                            <div class="text-dark mb-0 fw-bold h5"><span>$215,000</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-dollar-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow py-2 border-left-info">
                                <div class="card-body">
                                    <div class="row g-0 align-items-center">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-info mb-1 fw-bold text-xs"><span>Tasks</span></div>
                                            <div class="row g-0 align-items-center">
                                                <div class="col-auto">
                                                    <div class="text-dark me-3 mb-0 fw-bold h5"><span>50%</span></div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar bg-info" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 50%;"><span class="visually-hidden">50%</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-clipboard-list fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow py-2 border-left-warning">
                                <div class="card-body">
                                    <div class="row g-0 align-items-center">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-warning mb-1 fw-bold text-xs"><span>Pending Requests</span></div>
                                            <div class="text-dark mb-0 fw-bold h5"><span>18</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-comments fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
						<div class="row">

						  <!-- Earnings Overview -->
						  <div class="col-lg-7 col-xl-8">
							<div class="card shadow mb-4">
							  <div class="card-header d-flex justify-content-between align-items-center">
								<h6 class="text-primary m-0 fw-bold">Earnings Overview</h6>
								<div class="d-flex align-items-center gap-2">
								  <div class="btn-group btn-group-sm" role="group" aria-label="Range">
									<button class="btn btn-outline-primary active" type="button">MTD</button>
									<button class="btn btn-outline-primary" type="button">QTD</button>
									<button class="btn btn-outline-primary" type="button">YTD</button>
								  </div>
								  <div class="dropdown no-arrow">
									<button class="btn btn-link btn-sm dropdown-toggle" data-bs-toggle="dropdown" type="button" aria-expanded="false">
									  <i class="fas fa-ellipsis-v text-gray-400"></i>
									</button>
									<div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
									  <p class="text-center dropdown-header">Quick actions</p>
									  <a class="dropdown-item" href="#">&nbsp;Export CSV</a>
									  <a class="dropdown-item" href="#">&nbsp;Share Report</a>
									  <div class="dropdown-divider"></div>
									  <a class="dropdown-item" href="#">&nbsp;Refresh</a>
									</div>
								  </div>
								</div>
							  </div>

							  <!-- KPI strip -->
							  <div class="px-3 pt-3 pb-0">
								<div class="row text-center">
								  <div class="col-6 col-md-3 mb-3">
									<div class="small text-muted">MTD Earnings</div>
									<div class="fw-bold">$24,750</div>
								  </div>
								  <div class="col-6 col-md-3 mb-3">
									<div class="small text-muted">MoM Change</div>
									<div class="fw-bold text-success">+12.4%</div>
								  </div>
								  <div class="col-6 col-md-3 mb-3">
									<div class="small text-muted">Avg Deal Size</div>
									<div class="fw-bold">$2,180</div>
								  </div>
								  <div class="col-6 col-md-3 mb-3">
									<div class="small text-muted">Win Rate</div>
									<div class="fw-bold">31%</div>
								  </div>
								</div>
							  </div>

							  <div class="card-body pt-2">
								<div class="chart-area">
								  <canvas
									data-bss-chart='{
									  "type":"line",
									  "data":{
										"labels":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
										"datasets":[
										  {
											"label":"Actual",
											"fill":true,
											"data":["12000","18000","14500","22000","19500","25000","23000","28750","0","0","0","0"],
											"backgroundColor":"rgba(78,115,223,0.08)",
											"borderColor":"rgba(78,115,223,1)",
											"pointRadius":3,
											"pointHoverRadius":4,
											"lineTension":0.3
										  },
										  {
											"label":"Target",
											"fill":false,
											"data":["14000","16000","17000","19000","21000","23000","24000","26000","28000","30000","31000","32000"],
											"borderColor":"rgba(28,200,138,1)",
											"borderDash":[6,6],
											"pointRadius":0,
											"lineTension":0.3
										  }
										]
									  },
									  "options":{
										"maintainAspectRatio":false,
										"legend":{
										  "display":true,
										  "labels":{"fontStyle":"normal"}
										},
										"title":{"fontStyle":"normal"},
										"scales":{
										  "xAxes":[
											{
											  "gridLines":{
												"color":"rgb(234,236,244)",
												"zeroLineColor":"rgb(234,236,244)",
												"drawBorder":false,
												"drawTicks":false,
												"borderDash":["2"],
												"zeroLineBorderDash":["2"],
												"drawOnChartArea":false
											  },
											  "ticks":{"fontColor":"#858796","fontStyle":"normal","padding":20}
											}
										  ],
										  "yAxes":[
											{
											  "gridLines":{
												"color":"rgb(234,236,244)",
												"zeroLineColor":"rgb(234,236,244)",
												"drawBorder":false,
												"drawTicks":false,
												"borderDash":["2"],
												"zeroLineBorderDash":["2"]
											  },
											  "ticks":{
												"fontColor":"#858796",
												"fontStyle":"normal",
												"padding":20,
												"beginAtZero":true,
												"suggestedMax":32000
											  }
											}
										  ]
										},
										"elements":{"point":{"hitRadius":10,"hoverRadius":5}}
									  }
									}'></canvas>
								</div>

								<!-- Sub-footnotes -->
								<div class="row mt-3">
								  <div class="col-sm-6">
									<small class="text-muted">
									  <i class="fas fa-info-circle"></i>
									  Actual vs Target lines; shaded area = Actual.
									</small>
								  </div>
								  <div class="col-sm-6 text-sm-end">
									<span class="badge bg-success">On Track</span>
									<span class="badge bg-light text-dark">Forecast: $30k in Oct</span>
								  </div>
								</div>
							  </div>
							</div>
						  </div>

						  <!-- Lead / Revenue Sources -->
						  <div class="col-lg-5 col-xl-4">
							<div class="card shadow mb-4">
							  <div class="card-header d-flex justify-content-between align-items-center">
								<h6 class="text-primary m-0 fw-bold">Lead Sources</h6>
								<div class="dropdown no-arrow">
								  <button class="btn btn-link btn-sm dropdown-toggle" data-bs-toggle="dropdown" type="button" aria-expanded="false">
									<i class="fas fa-ellipsis-v text-gray-400"></i>
								  </button>
								  <div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
									<p class="text-center dropdown-header">Quick actions</p>
									<a class="dropdown-item" href="#">&nbsp;View Breakdown</a>
									<a class="dropdown-item" href="#">&nbsp;Export</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#">&nbsp;Refresh</a>
								  </div>
								</div>
							  </div>

							  <!-- mini KPIs -->
							  <div class="px-3 pt-3">
								<div class="row text-center">
								  <div class="col-4 mb-2">
									<div class="small text-muted">New Leads</div>
									<div class="fw-bold">275</div>
								  </div>
								  <div class="col-4 mb-2">
									<div class="small text-muted">Qualified</div>
									<div class="fw-bold">96</div>
								  </div>
								  <div class="col-4 mb-2">
									<div class="small text-muted">Conversion</div>
									<div class="fw-bold">18%</div>
								  </div>
								</div>
							  </div>

							  <div class="card-body pt-2">
								<div class="chart-area">
								  <canvas
									data-bss-chart='{
									  "type":"doughnut",
									  "data":{
										"labels":["Email Campaigns","Website Signups","Referrals","Events"],
										"datasets":[
										  {
											"label":"",
											"backgroundColor":["#4e73df","#1cc88a","#f6c23e","#e74a3b"],
											"borderColor":["#ffffff","#ffffff","#ffffff","#ffffff"],
											"data":["120","75","50","30"]
										  }
										]
									  },
									  "options":{
										"maintainAspectRatio":false,
										"legend":{"display":false,"labels":{"fontStyle":"normal"}},
										"title":{"fontStyle":"normal"},
										"cutoutPercentage":65
									  }
									}'></canvas>
								</div>

								<!-- Legend + bars -->
								<div class="mt-4 small">
								  <div class="d-flex justify-content-between align-items-center mb-2">
									<span><i class="fas fa-circle text-primary me-1"></i>Email Campaigns</span>
									<span class="fw-bold">120</span>
								  </div>
								  <div class="progress mb-3" style="height:6px;">
									<div class="progress-bar bg-primary" role="progressbar" style="width: 44%;" aria-valuenow="44" aria-valuemin="0" aria-valuemax="100"></div>
								  </div>

								  <div class="d-flex justify-content-between align-items-center mb-2">
									<span><i class="fas fa-circle text-success me-1"></i>Website Signups</span>
									<span class="fw-bold">75</span>
								  </div>
								  <div class="progress mb-3" style="height:6px;">
									<div class="progress-bar bg-success" role="progressbar" style="width: 27%;" aria-valuenow="27" aria-valuemin="0" aria-valuemax="100"></div>
								  </div>

								  <div class="d-flex justify-content-between align-items-center mb-2">
									<span><i class="fas fa-circle text-warning me-1"></i>Referrals</span>
									<span class="fw-bold">50</span>
								  </div>
								  <div class="progress mb-3" style="height:6px;">
									<div class="progress-bar bg-warning" role="progressbar" style="width: 18%;" aria-valuenow="18" aria-valuemin="0" aria-valuemax="100"></div>
								  </div>

								  <div class="d-flex justify-content-between align-items-center mb-2">
									<span><i class="fas fa-circle text-danger me-1"></i>Events</span>
									<span class="fw-bold">30</span>
								  </div>
								  <div class="progress" style="height:6px;">
									<div class="progress-bar bg-danger" role="progressbar" style="width: 11%;" aria-valuenow="11" aria-valuemin="0" aria-valuemax="100"></div>
								  </div>
								</div>

								<div class="mt-3 d-flex justify-content-between align-items-center">
								  <small class="text-muted">Top source: Email Campaigns</small>
								  <span class="badge bg-success">+8% WoW</span>
								</div>
							  </div>
							</div>
						  </div>

						</div>
                    <div class="row">
						<div class="col-lg-7 col-xl-8">
							<div class="card shadow mb-4">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h6 class="text-primary m-0 fw-bold">Client Engagement Score OverTime</h6>
									<div class="dropdown no-arrow">
										<button class="btn btn-link btn-sm dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button">
											<i class="fas fa-ellipsis-v text-gray-400"></i>
										</button>
										<div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
											<p class="text-center dropdown-header">dropdown header:</p>
											<a class="dropdown-item" href="#">&nbsp;Action</a>
											<a class="dropdown-item" href="#">&nbsp;Another action</a>
											<div class="dropdown-divider"></div>
											<a class="dropdown-item" href="#">&nbsp;Something else here</a>
										</div>
									</div>
								</div>
								<div class="card-body">
									<div class="iframe-area" style="height: 600px;">
										<iframe src="{% url 'client_engagement_dashboard' %}" style="width: 100%; height: 100%; border: none;"></iframe>
									</div>
								</div>
							</div>
						</div>
							<div class="col-lg-5 col-xl-4">
								<div class="card shadow mb-4">
									<div class="card-header d-flex justify-content-between align-items-center">
										<h6 class="text-primary m-0 fw-bold">Lead Sources</h6>
										<div class="dropdown no-arrow">
											<button class="btn btn-link btn-sm dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button">
												<i class="fas fa-ellipsis-v text-gray-400"></i>
											</button>
											<div class="dropdown-menu shadow dropdown-menu-end animated--fade-in">
												<p class="text-center dropdown-header">Options</p>
												<a class="dropdown-item" href="#">&nbsp;View Details</a>
												<a class="dropdown-item" href="#">&nbsp;Export Data</a>
												<div class="dropdown-divider"></div>
												<a class="dropdown-item" href="#">&nbsp;Refresh</a>
											</div>
										</div>
									</div>
									<div class="card-body">
										<div class="chart-area">
											<canvas data-bss-chart='{
												"type":"doughnut",
												"data":{
													"labels":["Email Campaigns","Website Signups","Referrals","Events"],
													"datasets":[{
														"label":"",
														"backgroundColor":["#4e73df","#1cc88a","#f6c23e","#e74a3b"],
														"borderColor":["#ffffff","#ffffff","#ffffff","#ffffff"],
														"data":["120","75","50","30"]
													}]
												},
												"options":{
													"maintainAspectRatio":false,
													"legend":{
														"display":false,
														"labels":{"fontStyle":"normal"}
													},
													"title":{"fontStyle":"normal"}
												}
											}'></canvas>
										</div>
										<div class="text-center mt-4 small">
											<span class="me-2"><i class="fas fa-circle text-primary"></i>&nbsp;Email Campaigns</span>
											<span class="me-2"><i class="fas fa-circle text-success"></i>&nbsp;Website Signups</span>
											<span class="me-2"><i class="fas fa-circle text-warning"></i>&nbsp;Referrals</span>
											<span class="me-2"><i class="fas fa-circle text-danger"></i>&nbsp;Events</span>
										</div>
									</div>
								</div>
							</div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="text-primary m-0 fw-bold">Projects</h6>
                                </div>
                                <div class="card-body">
                                    <h4 class="small fw-bold">Server migration<span class="float-end">20%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-danger" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%;"><span class="visually-hidden">20%</span></div>
                                    </div>
                                    <h4 class="small fw-bold">Sales tracking<span class="float-end">40%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-warning" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%;"><span class="visually-hidden">40%</span></div>
                                    </div>
                                    <h4 class="small fw-bold">Customer Database<span class="float-end">60%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-primary" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"><span class="visually-hidden">60%</span></div>
                                    </div>
                                    <h4 class="small fw-bold">Payout Details<span class="float-end">80%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-info" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;"><span class="visually-hidden">80%</span></div>
                                    </div>
                                    <h4 class="small fw-bold">Account setup<span class="float-end">Complete!</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar bg-success" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"><span class="visually-hidden">100%</span></div>
                                    </div>
                                </div>
                            </div>
								<div class="card shadow mb-4">
									<div class="card-header py-3 d-flex justify-content-between align-items-center">
										<h6 class="text-primary m-0 fw-bold">Todo List</h6>
										<a href="#" class="text-xs">+ Add Task</a>
									</div>
									<ul class="list-group list-group-flush">

										<!-- Task 1 -->
										<li class="list-group-item">
											<div class="row g-0 align-items-center">
												<div class="col me-2">
													<h6 class="mb-0"><strong>Follow up with client (Acme Corp)</strong></h6>
													<span class="text-xs text-muted">Due: 9:00 AM • <span class="badge bg-success">High Priority</span></span>
												</div>
												<div class="col-auto">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="task-1">
														<label class="form-check-label" for="task-1"></label>
													</div>
												</div>
											</div>
										</li>

										<!-- Task 2 -->
										<li class="list-group-item">
											<div class="row g-0 align-items-center">
												<div class="col me-2">
													<h6 class="mb-0"><strong>Team check-in call</strong></h6>
													<span class="text-xs text-muted">10:30 AM • <span class="badge bg-info text-dark">Meeting</span></span>
												</div>
												<div class="col-auto">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="task-2">
														<label class="form-check-label" for="task-2"></label>
													</div>
												</div>
											</div>
										</li>

										<!-- Task 3 -->
										<li class="list-group-item">
											<div class="row g-0 align-items-center">
												<div class="col me-2">
													<h6 class="mb-0"><strong>Send proposal draft to marketing</strong></h6>
													<span class="text-xs text-muted">11:45 AM • <span class="badge bg-warning text-dark">Pending Review</span></span>
												</div>
												<div class="col-auto">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="task-3">
														<label class="form-check-label" for="task-3"></label>
													</div>
												</div>
											</div>
										</li>

										<!-- Task 4 -->
										<li class="list-group-item">
											<div class="row g-0 align-items-center">
												<div class="col me-2">
													<h6 class="mb-0"><strong>Prepare CRM report for Q3</strong></h6>
													<span class="text-xs text-muted">2:00 PM • <span class="badge bg-primary">Report</span></span>
												</div>
												<div class="col-auto">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="task-4">
														<label class="form-check-label" for="task-4"></label>
													</div>
												</div>
											</div>
										</li>

										<!-- Task 5 -->
										<li class="list-group-item">
											<div class="row g-0 align-items-center">
												<div class="col me-2">
													<h6 class="mb-0"><strong>Follow up: new leads from webinar</strong></h6>
													<span class="text-xs text-muted">4:00 PM • <span class="badge bg-danger">Urgent</span></span>
												</div>
												<div class="col-auto">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="task-5">
														<label class="form-check-label" for="task-5"></label>
													</div>
												</div>
											</div>
										</li>

									</ul>
								</div>
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-primary shadow">
                                        <div class="card-body">
                                            <p class="m-0">Primary</p>
                                            <p class="text-white-50 m-0 small">#4e73df</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-success shadow">
                                        <div class="card-body">
                                            <p class="m-0">Success</p>
                                            <p class="text-white-50 m-0 small">#1cc88a</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-info shadow">
                                        <div class="card-body">
                                            <p class="m-0">Info</p>
                                            <p class="text-white-50 m-0 small">#36b9cc</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-warning shadow">
                                        <div class="card-body">
                                            <p class="m-0">Warning</p>
                                            <p class="text-white-50 m-0 small">#f6c23e</p>
                                        </div>
                                    </div>
                                </div>
								<div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-warning shadow">
                                        <div class="card-body">
                                            <p class="m-0">Warning</p>
                                            <p class="text-white-50 m-0 small">#f6c23e</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-danger shadow">
                                        <div class="card-body">
                                            <p class="m-0">Danger</p>
                                            <p class="text-white-50 m-0 small">#e74a3b</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <div class="card text-white bg-secondary shadow">
                                        <div class="card-body">
                                            <p class="m-0">Secondary</p>
                                            <p class="text-white-50 m-0 small">#858796</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
<!-- Modal markup -->
<!-- Participant ID Modal -->
<div id="pidModal" class="pid-modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="pid-backdrop" data-pid-close></div>
  <div class="pid-dialog" role="document" aria-labelledby="pidModalTitle">
    <button class="pid-close" type="button" data-pid-close aria-label="Close">×</button>
    <h2 id="pidModalTitle">Enter Participant ID</h2>

    <form method="post" action="{% url 'research_login' %}">
      {% csrf_token %}
      <label for="participant_id" class="pid-label">Participant ID</label>
      <input id="participant_id" name="participant_id" class="pid-input" placeholder="e.g., P-001" required autofocus>
      <button class="pid-submit" type="submit">Continue</button>
    </form>

    <p class="pid-note">No personal info is collected—use the study ID you were given.</p>
  </div>
</div>

<script>
// Immediate execution - no waiting for DOM
console.log('Script executing immediately...');

function getCookie(name) {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
        const [key, value] = cookie.trim().split('=');
        if (key === name) return decodeURIComponent(value || '');
    }
    return null;
}

function setCookie(name, value) {
    document.cookie = `${name}=${encodeURIComponent(value)}; path=/; max-age=31536000`;
}

function doPopup() {
    const id = prompt('Enter Participant ID:');
    if (id && id.trim()) {
        setCookie('participant_id', id.trim());
        setCookie('username', id.trim());
        alert('Saved: ' + id.trim());
        location.reload();
    } else if (id !== null) {
        alert('Please enter valid ID');
        doPopup();
    }
}

// Make globally available immediately
window.doPopup = doPopup;
window.testCookies = function() {
    console.log('Cookies:', document.cookie);
};

// Check cookies
const existing = getCookie('participant_id') || getCookie('username');
console.log('Found ID:', existing);

if (!existing) {
    console.log('No ID found, will show popup');
    setTimeout(doPopup, 1500);
} else {
    console.log('ID exists:', existing);
}

console.log('Script complete, doPopup available');
</script>

{% endblock %}
{% block extra_js %}

{% endblock %}

