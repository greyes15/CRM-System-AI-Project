{# templates/clientmanager/employee_user_manual.html #}
{% load static %}

{% block title %}Employee User Manual{% endblock %}

{% block content %}
<style>
  .pdf-wrap{position:relative}
  .pdf-frame{width:100%;height:80vh;border:0}
  .pdf-overlay{
    position:absolute; inset:0; background:transparent; cursor:pointer;
    /* optional visual cue on hover: */
    /* background: rgba(0,0,0,.02); */
  }
</style>

<div class="container py-3">
  <div class="pdf-wrap">
    <iframe
      id="manualPdf"
      class="pdf-frame rounded shadow"
      src="{% static 'docs/EMPLOYEE USER MANUAL.pdf' %}#view=FitH"
      title="Employee User Manual"
      tabindex="0"></iframe>

    <!-- Transparent layer that logs the first click, then gets removed -->
    <div id="pdfOverlay" class="pdf-overlay" aria-label="Activate PDF"></div>
  </div>
</div>

<script>
(function(){
  function getCookie(name){
    const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)'); return m ? decodeURIComponent(m.pop()) : null;
  }
  function sendEvent(event_type, element, value, keepalive){
    fetch("/track-event/", {
      method:"POST", credentials:"same-origin", keepalive:!!keepalive,
      headers:{"Content-Type":"application/json","X-CSRFToken": getCookie("csrftoken") || ""},
      body: JSON.stringify({
        username: getCookie("username") || getCookie("participant_id") || "guest",
        event_type, element: element||"", value: value||"", page: window.location.pathname
      })
    }).catch(()=>{});
  }

  // 1) First click anywhere on the PDF area
  const overlay = document.getElementById('pdfOverlay');
  overlay.addEventListener('click', () => {
    sendEvent("click", "PDF_IFRAME_ACTIVATED", "", false);
    overlay.remove(); // allow native PDF interactions
  });

  // 2) Fallback: focus event (fires on click in some browsers)
  const iframe = document.getElementById('manualPdf');
  iframe.addEventListener('focus', () => {
    sendEvent("click", "PDF_IFRAME_FOCUS", "", false);
  });
})();
</script>
{% endblock %}
